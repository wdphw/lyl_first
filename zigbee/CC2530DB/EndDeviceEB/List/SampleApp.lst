###############################################################################
#
# IAR C/C++ Compiler V10.10.1.4655 for 8051               24/Nov/2024  18:33:58
# Copyright 2004-2017 IAR Systems AB.
# Standalone license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
#    Command line       =  
#        -f C:\Users\lyl\AppData\Local\Temp\EWFDD4.tmp
#        (C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
#        -D NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC
#        -D LCD_SUPPORTED=DEBUG -D HAL_UART=TRUE -D INT_HEAP_LEN=2048 -lC
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\List
#        -lA
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\List
#        --diag_suppress Pe001,Pa010 -o
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\Obj
#        -e --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 16 -f
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3
#        -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg
#        (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00000800 -DZDAPP_CONFIG_PAN_ID=0x1345
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01, 0x03, 0x05, 0x07,
#        0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C,
#        0x0D}" -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=20
#        "-DCONST=const __code" -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE
#        -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100
#        -DREJOIN_POLL_RATE=440) -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\Source\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\ZMain\TI2530DB\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\hal\include\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mac\include\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mac\high_level\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mt\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\osal\include\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\services\saddr\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\services\sdata\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\af\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\nwk\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\sapi\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\sec\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\sys\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\zdo\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\zmac\
#        -I
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\zmac\f8w\
#        -Ohz --require_prototypes --no_code_motion)
#    Locale             =  Chinese (Simplified)_China.936
#    List file          =  
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\List\SampleApp.lst
#    Object file        =  
#        C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\Obj\SampleApp.r51
#
###############################################################################

C:\Users\lyl\Desktop\share\20190508基于GEC6818+Zigbee温湿度\20190508基于GEC6818+Zigbee温湿度\ZigBee\协调器\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
      1          /**************************************************************************************************
      2            Filename:       SampleApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Sample Application (no Profile).
      7          
      8          
      9            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends it's messages either as broadcast or
     45            broadcast filtered group messages.  The other (more normal)
     46            message addressing is unicast.  Most of the other sample
     47            applications are written to support the unicast message model.
     48          
     49            Key control:
     50              SW1:  Sends a flash command to all devices in Group 1.
     51              SW2:  Adds/Removes (toggles) this device in and out
     52                    of Group 1.  This will enable and disable the
     53                    reception of the flash command.
     54          *********************************************************************/
     55          
     56          /*********************************************************************
     57           * INCLUDES
     58           */
     59          #include "OSAL.h"
     60          #include "ZGlobals.h"
     61          #include "AF.h"
     62          #include "aps_groups.h"
     63          #include "ZDApp.h"
     64          
     65          #include "SampleApp.h"
     66          #include "SampleAppHw.h"
     67          
     68          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf4
   \   unsigned char volatile __sfr P1SEL
   \                     P1SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     69          #include "MT_UART.h"
     70          #include "hal_uart.h"
     71          #include "MT.h"
     72          #include "dht11.h"
     73          #include "adc.h"
     74          #include <stdio.h>
     75          #include <string.h>
     76          
     77          /* HAL */
     78          #include "hal_lcd.h"
     79          #include "hal_led.h"
     80          #include "hal_key.h"
     81          
     82          #include <ioCC2530.h>
     83          #define B_LED P1_0
     84          #define Y_LED P1_1
     85          #define LEDOPEN  1
     86          #define LEDCLOSE  0
     87          
     88          /*********************************************************************
     89           * MACROS
     90           */
     91          
     92          /*********************************************************************
     93           * CONSTANTS
     94           */
     95          
     96          /*********************************************************************
     97           * TYPEDEFS
     98           */
     99          
    100          /*********************************************************************
    101           * GLOBAL VARIABLES
    102           */
    103          
    104          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    105          const cId_t SampleApp_ClusterList[SAMPLEAPP_MAX_CLUSTERS] =
   \                     SampleApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
    106          {
    107            SAMPLEAPP_PERIODIC_CLUSTERID,
    108            SAMPLEAPP_FLASH_CLUSTERID
    109          };
    110          

   \                                 In  segment XDATA_ROM_C, align 1
    111          const SimpleDescriptionFormat_t SampleApp_SimpleDesc =
   \                     SampleApp_SimpleDesc:
   \   000000   14           DB 20
   \   000001   080F         DW 3848
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   02           DB 2
   \   000007   ....         DW SampleApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW SampleApp_ClusterList
    112          {
    113            SAMPLEAPP_ENDPOINT,              //  int Endpoint;
    114            SAMPLEAPP_PROFID,                //  uint16 AppProfId[2];
    115            SAMPLEAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    116            SAMPLEAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    117            SAMPLEAPP_FLAGS,                 //  int   AppFlags:4;
    118            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    119            (cId_t *)SampleApp_ClusterList,  //  uint8 *pAppInClusterList;
    120            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    121            (cId_t *)SampleApp_ClusterList   //  uint8 *pAppInClusterList;
    122          };
    123          
    124          // This is the Endpoint/Interface description.  It is defined here, but
    125          // filled-in in SampleApp_Init().  Another way to go would be to fill
    126          // in the structure here and make it a "const" (in code space).  The
    127          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    128          endPointDesc_t SampleApp_epDesc;
   \                     SampleApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    129          
    130          /*********************************************************************
    131           * EXTERNAL VARIABLES
    132           */
    133          
    134          /*********************************************************************
    135           * EXTERNAL FUNCTIONS
    136           */
    137          
    138          /*********************************************************************
    139           * LOCAL VARIABLES
    140           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          uint8 SampleApp_TaskID;   // Task ID for internal task/event processing
   \                     SampleApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    142                                    // This variable will be received when
    143                                    // SampleApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          devStates_t SampleApp_NwkState;
   \                     SampleApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    145          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          uint8 SampleApp_TransID;  // This is the unique message ID (counter)
   \                     SampleApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    147          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148          afAddrType_t SampleApp_Periodic_DstAddr;
   \                     SampleApp_Periodic_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    149          afAddrType_t SampleApp_Flash_DstAddr;
   \                     SampleApp_Flash_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    150          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    151          aps_Group_t SampleApp_Group;
   \                     SampleApp_Group:
   \   000000                DS 18
   \   000012                REQUIRE __INIT_XDATA_Z
    152          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    153          uint8 SampleAppPeriodicCounter = 0;
   \                     SampleAppPeriodicCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          uint8 SampleAppFlashCounter = 0;
   \                     SampleAppFlashCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    155          
    156          /*********************************************************************
    157           * LOCAL FUNCTIONS
    158           */
    159          void SampleApp_HandleKeys( uint8 shift, uint8 keys );
    160          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    161          void SampleApp_SendPeriodicMessage( void );
    162          void SampleApp_SendFlashMessage( uint16 flashTime );
    163          void SampleApp_SendToCoordinator( void );
    164          static void zclSampleSw_InitUart(void);
    165          
    166          /*********************************************************************
    167           * NETWORK LAYER CALLBACKS
    168           */
    169          
    170          /*********************************************************************
    171           * PUBLIC FUNCTIONS
    172           */
    173          
    174          /*********************************************************************
    175           * @fn      SampleApp_Init
    176           *
    177           * @brief   Initialization function for the Generic App Task.
    178           *          This is called during initialization and should contain
    179           *          any application specific initialization (ie. hardware
    180           *          initialization/setup, table initialization, power up
    181           *          notificaiton ... ).
    182           *
    183           * @param   task_id - the ID assigned by OSAL.  This ID should be
    184           *                    used to send messages and set timers.
    185           *
    186           * @return  none
    187           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    188          void SampleApp_Init( uint8 task_id )
   \                     SampleApp_Init:
    189          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000   74F5         MOV       A,#-0xb
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV       A,#-0x1d
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
    190            SampleApp_TaskID = task_id;
   \   00000B   90....       MOV       DPTR,#SampleApp_TaskID
   \   00000E   F0           MOVX      @DPTR,A
    191            SampleApp_NwkState = DEV_INIT;
   \   00000F   90....       MOV       DPTR,#SampleApp_NwkState
   \   000012   7401         MOV       A,#0x1
   \   000014   F0           MOVX      @DPTR,A
    192            SampleApp_TransID = 0;
   \   000015   90....       MOV       DPTR,#SampleApp_TransID
   \   000018   E4           CLR       A
   \   000019   F0           MOVX      @DPTR,A
    193            
    194            /*******初始化led********/
    195            P1SEL &= 0;
   \   00001A   E5F4         MOV       A,0xf4
   \   00001C   75F400       MOV       0xf4,#0x0
    196            P1DIR |= 3;
   \   00001F   43FE03       ORL       0xfe,#0x3
    197            Y_LED = LEDCLOSE;
   \   000022   C291         CLR       0x90.1
    198            B_LED = LEDCLOSE;  
   \   000024   C290         CLR       0x90.0
    199          
    200            //MT_UartInit();
    201            //MT_UartRegisterTaskID(task_id);
    202            zclSampleSw_InitUart();
   \   000026   7401         MOV       A,#0x1
   \   000028   12....       LCALL     ?XSTACK_DISP0_8
   \   00002B   7404         MOV       A,#0x4
   \   00002D   F0           MOVX      @DPTR,A
   \   00002E   7402         MOV       A,#0x2
   \   000030   12....       LCALL     ?XSTACK_DISP0_8
   \   000033   E4           CLR       A
   \   000034   F0           MOVX      @DPTR,A
   \   000035   7403         MOV       A,#0x3
   \   000037   12....       LCALL     ?XSTACK_DISP0_8
   \   00003A   E4           CLR       A
   \   00003B   F0           MOVX      @DPTR,A
   \   00003C   A3           INC       DPTR
   \   00003D   F0           MOVX      @DPTR,A
   \   00003E   740A         MOV       A,#0xa
   \   000040   12....       LCALL     ?XSTACK_DISP0_8
   \   000043   7480         MOV       A,#-0x80
   \   000045   F0           MOVX      @DPTR,A
   \   000046   A3           INC       DPTR
   \   000047   E4           CLR       A
   \   000048   F0           MOVX      @DPTR,A
   \   000049   7412         MOV       A,#0x12
   \   00004B   12....       LCALL     ?XSTACK_DISP0_8
   \   00004E   7480         MOV       A,#-0x80
   \   000050   F0           MOVX      @DPTR,A
   \   000051   A3           INC       DPTR
   \   000052   E4           CLR       A
   \   000053   F0           MOVX      @DPTR,A
   \   000054   7405         MOV       A,#0x5
   \   000056   12....       LCALL     ?XSTACK_DISP0_8
   \   000059   7406         MOV       A,#0x6
   \   00005B   F0           MOVX      @DPTR,A
   \   00005C   7416         MOV       A,#0x16
   \   00005E   12....       LCALL     ?XSTACK_DISP0_8
   \   000061   7401         MOV       A,#0x1
   \   000063   F0           MOVX      @DPTR,A
   \   000064   741B         MOV       A,#0x1b
   \   000066   12....       LCALL     ?XSTACK_DISP0_8
   \   000069   74..         MOV       A,#`??zclSampleSw_UartCB::?relay` & 0xff
   \   00006B   F0           MOVX      @DPTR,A
   \   00006C   A3           INC       DPTR
   \   00006D   74..         MOV       A,#(`??zclSampleSw_UartCB::?relay` >> 8) & 0xff
   \   00006F   F0           MOVX      @DPTR,A
   \   000070                ; Setup parameters for call to function HalUARTOpen
   \   000070   AA..         MOV       R2,?XSP + 0
   \   000072   AB..         MOV       R3,?XSP + 1
   \   000074   7900         MOV       R1,#0x0
   \   000076   12....       LCALL     `??HalUARTOpen::?relay`; Banked call to: HalUARTOpen
    203            //HalUARTWrite(0,"hello\n",6);
    204            
    205            // Device hardware initialization can be added here or in main() (Zmain.c).
    206            // If the hardware is application specific - add it here.
    207            // If the hardware is other parts of the device add it in main().
    208          
    209           #if defined ( BUILD_ALL_DEVICES )
    210            // The "Demo" target is setup to have BUILD_ALL_DEVICES and HOLD_AUTO_START
    211            // We are looking at a jumper (defined in SampleAppHw.c) to be jumpered
    212            // together - if they are - we will start up a coordinator. Otherwise,
    213            // the device will start as a router.
    214            if ( readCoordinatorJumper() )
    215              zgDeviceLogicalType = ZG_DEVICETYPE_COORDINATOR;
    216            else
    217              zgDeviceLogicalType = ZG_DEVICETYPE_ROUTER;
    218          #endif // BUILD_ALL_DEVICES
    219          
    220          #if defined ( HOLD_AUTO_START )
    221            // HOLD_AUTO_START is a compile option that will surpress ZDApp
    222            //  from starting the device and wait for the application to
    223            //  start the device.
    224            ZDOInitDevice(0);
    225          #endif
    226          
    227            // Setup for the periodic message's destination address
    228            // Broadcast to everyone
    229            SampleApp_Periodic_DstAddr.addrMode = (afAddrMode_t)AddrBroadcast;
   \   000079   90....       MOV       DPTR,#SampleApp_Periodic_DstAddr + 8
   \   00007C   740F         MOV       A,#0xf
   \   00007E   F0           MOVX      @DPTR,A
    230            SampleApp_Periodic_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   00007F   A3           INC       DPTR
   \   000080   7414         MOV       A,#0x14
   \   000082   F0           MOVX      @DPTR,A
    231            SampleApp_Periodic_DstAddr.addr.shortAddr = 0xFFFF;
   \   000083   90....       MOV       DPTR,#SampleApp_Periodic_DstAddr
   \   000086   74FF         MOV       A,#-0x1
   \   000088   F0           MOVX      @DPTR,A
   \   000089   A3           INC       DPTR
   \   00008A   F0           MOVX      @DPTR,A
    232          
    233            // Setup for the flash command's destination address - Group 1
    234            SampleApp_Flash_DstAddr.addrMode = (afAddrMode_t)afAddrGroup;
   \   00008B   90....       MOV       DPTR,#SampleApp_Flash_DstAddr + 8
   \   00008E   7401         MOV       A,#0x1
   \   000090   F0           MOVX      @DPTR,A
    235            SampleApp_Flash_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   000091   A3           INC       DPTR
   \   000092   7414         MOV       A,#0x14
   \   000094   F0           MOVX      @DPTR,A
    236            SampleApp_Flash_DstAddr.addr.shortAddr = SAMPLEAPP_FLASH_GROUP;
   \   000095   90....       MOV       DPTR,#SampleApp_Flash_DstAddr
   \   000098   7401         MOV       A,#0x1
   \   00009A   F0           MOVX      @DPTR,A
   \   00009B   A3           INC       DPTR
   \   00009C   E4           CLR       A
   \   00009D   F0           MOVX      @DPTR,A
    237          
    238            // Fill out the endpoint description.
    239            SampleApp_epDesc.endPoint = SAMPLEAPP_ENDPOINT;
   \   00009E   90....       MOV       DPTR,#SampleApp_epDesc
   \   0000A1   7414         MOV       A,#0x14
   \   0000A3   F0           MOVX      @DPTR,A
    240            SampleApp_epDesc.task_id = &SampleApp_TaskID;
   \   0000A4   A3           INC       DPTR
   \   0000A5   74..         MOV       A,#SampleApp_TaskID & 0xff
   \   0000A7   F0           MOVX      @DPTR,A
   \   0000A8   A3           INC       DPTR
   \   0000A9   74..         MOV       A,#(SampleApp_TaskID >> 8) & 0xff
   \   0000AB   F0           MOVX      @DPTR,A
    241            SampleApp_epDesc.simpleDesc
    242                      = (SimpleDescriptionFormat_t *)&SampleApp_SimpleDesc;
   \   0000AC   A3           INC       DPTR
   \   0000AD   74..         MOV       A,#SampleApp_SimpleDesc & 0xff
   \   0000AF   F0           MOVX      @DPTR,A
   \   0000B0   A3           INC       DPTR
   \   0000B1   74..         MOV       A,#(SampleApp_SimpleDesc >> 8) & 0xff
   \   0000B3   F0           MOVX      @DPTR,A
    243            SampleApp_epDesc.latencyReq = noLatencyReqs;
   \   0000B4   A3           INC       DPTR
   \   0000B5   E4           CLR       A
   \   0000B6   F0           MOVX      @DPTR,A
    244          
    245            // Register the endpoint description with the AF
    246            afRegister( &SampleApp_epDesc );
   \   0000B7                ; Setup parameters for call to function afRegister
   \   0000B7   7A..         MOV       R2,#SampleApp_epDesc & 0xff
   \   0000B9   7B..         MOV       R3,#(SampleApp_epDesc >> 8) & 0xff
   \   0000BB   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    247          
    248            // Register for all key events - This app will handle all key events
    249            RegisterForKeys( SampleApp_TaskID );
   \   0000BE                ; Setup parameters for call to function RegisterForKeys
   \   0000BE   90....       MOV       DPTR,#SampleApp_TaskID
   \   0000C1   E0           MOVX      A,@DPTR
   \   0000C2   F9           MOV       R1,A
   \   0000C3   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    250          
    251            // By default, all devices start out in Group 1
    252            SampleApp_Group.ID = 0x0001;
   \   0000C6   90....       MOV       DPTR,#SampleApp_Group
   \   0000C9   7401         MOV       A,#0x1
   \   0000CB   F0           MOVX      @DPTR,A
   \   0000CC   A3           INC       DPTR
   \   0000CD   E4           CLR       A
   \   0000CE   F0           MOVX      @DPTR,A
    253            osal_memcpy( SampleApp_Group.name, "Group 1", 7  );
   \   0000CF                ; Setup parameters for call to function osal_memcpy
   \   0000CF   75....       MOV       ?V0,#`?<Constant "Group 1">` & 0xff
   \   0000D2   75....       MOV       ?V1,#(`?<Constant "Group 1">` >> 8) & 0xff
   \   0000D5   F5..         MOV       ?V2,A
   \   0000D7   78..         MOV       R0,#?V0
   \   0000D9   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   0000DC   7C07         MOV       R4,#0x7
   \   0000DE   7D00         MOV       R5,#0x0
   \   0000E0   7A..         MOV       R2,#(SampleApp_Group + 2) & 0xff
   \   0000E2   7B..         MOV       R3,#((SampleApp_Group + 2) >> 8) & 0xff
   \   0000E4   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   0000E7   7403         MOV       A,#0x3
   \   0000E9   12....       LCALL     ?DEALLOC_XSTACK8
    254            aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group );
   \   0000EC                ; Setup parameters for call to function aps_AddGroup
   \   0000EC   7A..         MOV       R2,#SampleApp_Group & 0xff
   \   0000EE   7B..         MOV       R3,#(SampleApp_Group >> 8) & 0xff
   \   0000F0   7914         MOV       R1,#0x14
   \   0000F2   12....       LCALL     `??aps_AddGroup::?relay`; Banked call to: aps_AddGroup
    255          
    256          #if defined ( LCD_SUPPORTED )
    257            HalLcdWriteString( "SampleApp", HAL_LCD_LINE_1 );
   \   0000F5                ; Setup parameters for call to function HalLcdWriteString
   \   0000F5   7901         MOV       R1,#0x1
   \   0000F7   7A..         MOV       R2,#`?<Constant "SampleApp">` & 0xff
   \   0000F9   7B..         MOV       R3,#(`?<Constant "SampleApp">` >> 8) & 0xff
   \   0000FB   12....       LCALL     `??HalLcdWriteString::?relay`; Banked call to: HalLcdWriteString
    258          #endif
    259            
    260            //发给协调器事件
    261            osal_start_timerEx(SampleApp_TaskID, SAMPLEAPP_SEND_TO_COORDINATOR_EVT, SAMPLEAPP_SEND_TO_COORDINATOR_TIMEOUT);
   \   0000FE                ; Setup parameters for call to function osal_start_timerEx
   \   0000FE   7CD0         MOV       R4,#-0x30
   \   000100   7D07         MOV       R5,#0x7
   \   000102   7A02         MOV       R2,#0x2
   \   000104   7B00         MOV       R3,#0x0
   \   000106   90....       MOV       DPTR,#SampleApp_TaskID
   \   000109   E0           MOVX      A,@DPTR
   \   00010A   F9           MOV       R1,A
   \   00010B   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
    262          //osal_start_timerEx( SampleApp_TaskID,
    263          //                              SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    264          //                              SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT );
    265          }
   \   00010E   741D         MOV       A,#0x1d
   \   000110   12....       LCALL     ?DEALLOC_XSTACK8
   \   000113   7F03         MOV       R7,#0x3
   \   000115   02....       LJMP      ?BANKED_LEAVE_XDATA
   \   000118                REQUIRE P1SEL
   \   000118                REQUIRE P1DIR
   \   000118                REQUIRE _A_P1
    266          
    267          /*********************************************************************
    268           * @fn      SampleApp_ProcessEvent
    269           *
    270           * @brief   Generic Application Task event processor.  This function
    271           *          is called to process all events for the task.  Events
    272           *          include timers, messages and any other user defined events.
    273           *
    274           * @param   task_id  - The OSAL assigned task ID.
    275           * @param   events - events to process.  This is a bit map and can
    276           *                   contain more than one event.
    277           *
    278           * @return  none
    279           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    280          uint16 SampleApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     SampleApp_ProcessEvent:
    281          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
    282            afIncomingMSGPacket_t *MSGpkt;
    283            (void)task_id;  // Intentionally unreferenced parameter
    284          
    285            if ( events & SYS_EVENT_MSG )
   \   000009   5480         ANL       A,#0x80
   \   00000B   6078         JZ        ??SampleApp_ProcessEvent_0
    286            {
    287              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
   \   00000D                ; Setup parameters for call to function osal_msg_receive
   \   00000D   802B         SJMP      ??SampleApp_ProcessEvent_1
    288              while ( MSGpkt )
    289              {
    290                switch ( MSGpkt->hdr.event )
    291                {
    292                  // Received when a key is pressed
    293                  case KEY_CHANGE:
    294                    SampleApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    295                    break;
    296          
    297                  // Received when a messages is received (OTA) for this endpoint
    298                  case AF_INCOMING_MSG_CMD:
    299                    SampleApp_MessageMSGCB( MSGpkt );
    300                    break;
    301          
    302                  // Received whenever the device changes state in the network
    303                  case ZDO_STATE_CHANGE:
    304                    SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??SampleApp_ProcessEvent_2:
   \   00000F   A3           INC       DPTR
   \   000010   E0           MOVX      A,@DPTR
   \   000011   90....       MOV       DPTR,#SampleApp_NwkState
   \   000014   F0           MOVX      @DPTR,A
    305                   
    306                    if ((SampleApp_NwkState == DEV_ZB_COORD)
    307                        ||(SampleApp_NwkState == DEV_ROUTER)
    308                        || (SampleApp_NwkState == DEV_END_DEVICE) )
   \   000015   6409         XRL       A,#0x9
   \   000017   600A         JZ        ??SampleApp_ProcessEvent_3
   \   000019   E0           MOVX      A,@DPTR
   \   00001A   6407         XRL       A,#0x7
   \   00001C   6005         JZ        ??SampleApp_ProcessEvent_3
   \   00001E   E0           MOVX      A,@DPTR
   \   00001F   6406         XRL       A,#0x6
   \   000021   7010         JNZ       ??SampleApp_ProcessEvent_4
    309                    {
    310                      // Start sending the periodic message in a regular interval.
    311                      osal_start_timerEx( SampleApp_TaskID,
    312                                        SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    313                                        SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT );
   \                     ??SampleApp_ProcessEvent_3:
   \   000023                ; Setup parameters for call to function osal_start_timerEx
   \   000023   7CD0         MOV       R4,#-0x30
   \   000025   7D07         MOV       R5,#0x7
   \   000027   7A01         MOV       R2,#0x1
   \   000029   7B00         MOV       R3,#0x0
   \   00002B   90....       MOV       DPTR,#SampleApp_TaskID
   \   00002E   E0           MOVX      A,@DPTR
   \   00002F   F9           MOV       R1,A
   \   000030   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
    314                    }
    315                    else
    316                    {
    317                      // Device is no longer in the network
    318                    }
    319                    break;
    320          
    321                  default:
    322                    break;
    323                }
    324          
    325                // Release the memory
    326                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??SampleApp_ProcessEvent_4:
   \   000033                ; Setup parameters for call to function osal_msg_deallocate
   \   000033   AA..         MOV       R2,?V0
   \   000035   AB..         MOV       R3,?V1
   \   000037   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
    327          
    328                // Next - if one is available
    329                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
   \   00003A                ; Setup parameters for call to function osal_msg_receive
   \                     ??SampleApp_ProcessEvent_1:
   \   00003A   90....       MOV       DPTR,#SampleApp_TaskID
   \   00003D   E0           MOVX      A,@DPTR
   \   00003E   F9           MOV       R1,A
   \   00003F   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   000042   8A..         MOV       ?V0,R2
   \   000044   8B..         MOV       ?V1,R3
   \   000046   E5..         MOV       A,?V0
   \   000048   45..         ORL       A,?V1
   \   00004A   6032         JZ        ??SampleApp_ProcessEvent_5
   \   00004C   85..82       MOV       DPL,?V0
   \   00004F   85..83       MOV       DPH,?V1
   \   000052   E0           MOVX      A,@DPTR
   \   000053   24E6         ADD       A,#-0x1a
   \   000055   601E         JZ        ??SampleApp_ProcessEvent_6
   \   000057   245A         ADD       A,#0x5a
   \   000059   6006         JZ        ??SampleApp_ProcessEvent_7
   \   00005B   24EF         ADD       A,#-0x11
   \   00005D   60B0         JZ        ??SampleApp_ProcessEvent_2
   \   00005F   80D2         SJMP      ??SampleApp_ProcessEvent_4
   \                     ??SampleApp_ProcessEvent_7:
   \   000061                ; Setup parameters for call to function SampleApp_HandleKeys
   \   000061   A3           INC       DPTR
   \   000062   A3           INC       DPTR
   \   000063   A3           INC       DPTR
   \   000064   E0           MOVX      A,@DPTR
   \   000065   FA           MOV       R2,A
   \   000066   85..82       MOV       DPL,?V0
   \   000069   85..83       MOV       DPH,?V1
   \   00006C   A3           INC       DPTR
   \   00006D   A3           INC       DPTR
   \   00006E   E0           MOVX      A,@DPTR
   \   00006F   F9           MOV       R1,A
   \   000070   12....       LCALL     `??SampleApp_HandleKeys::?relay`; Banked call to: SampleApp_HandleKeys
   \   000073   80BE         SJMP      ??SampleApp_ProcessEvent_4
   \                     ??SampleApp_ProcessEvent_6:
   \   000075                ; Setup parameters for call to function SampleApp_MessageMSGCB
   \   000075   AA..         MOV       R2,?V0
   \   000077   AB..         MOV       R3,?V1
   \   000079   12....       LCALL     `??SampleApp_MessageMSGCB::?relay`; Banked call to: SampleApp_MessageMSGCB
   \   00007C   80B5         SJMP      ??SampleApp_ProcessEvent_4
    330              }
    331          
    332              // return unprocessed events
    333              return (events ^ SYS_EVENT_MSG);
   \                     ??SampleApp_ProcessEvent_5:
   \   00007E   EE           MOV       A,R6
   \   00007F   FA           MOV       R2,A
   \   000080   EF           MOV       A,R7
   \   000081   6480         XRL       A,#0x80
   \   000083   801D         SJMP      ??SampleApp_ProcessEvent_8
    334            }
    335          
    336            // Send a message out - This event is generated by a timer
    337            //  (setup in SampleApp_Init()).
    338          //  if ( events & SAMPLEAPP_SEND_PERIODIC_MSG_EVT )
    339          //  {
    340          //    // Send the periodic message
    341          //    SampleApp_SendPeriodicMessage();
    342          //
    343          //    // Setup to send message again in normal period (+ a little jitter)
    344          //    osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    345          //        (SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT + (osal_rand() & 0x00FF)) );
    346          //
    347          //    // return unprocessed events
    348          //    return (events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
    349          //  }
    350            
    351             // Send a message to coordinator - This event is generated by a timer
    352          if (events & SAMPLEAPP_SEND_TO_COORDINATOR_EVT)
   \                     ??SampleApp_ProcessEvent_0:
   \   000085   EE           MOV       A,R6
   \   000086   5402         ANL       A,#0x2
   \   000088   601B         JZ        ??SampleApp_ProcessEvent_9
    353          {
    354          // Send the message to coordinator
    355          SampleApp_SendToCoordinator();
   \   00008A                ; Setup parameters for call to function SampleApp_SendToCoordinator
   \   00008A   12....       LCALL     `??SampleApp_SendToCoordinator::?relay`; Banked call to: SampleApp_SendToCoordinator
    356          
    357          // Setup to send message again in normal period (+ a little jitter)
    358          osal_start_timerEx(SampleApp_TaskID, SAMPLEAPP_SEND_TO_COORDINATOR_EVT,
    359              SAMPLEAPP_SEND_TO_COORDINATOR_TIMEOUT);
   \   00008D                ; Setup parameters for call to function osal_start_timerEx
   \   00008D   7CD0         MOV       R4,#-0x30
   \   00008F   7D07         MOV       R5,#0x7
   \   000091   7A02         MOV       R2,#0x2
   \   000093   7B00         MOV       R3,#0x0
   \   000095   90....       MOV       DPTR,#SampleApp_TaskID
   \   000098   E0           MOVX      A,@DPTR
   \   000099   F9           MOV       R1,A
   \   00009A   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
    360          
    361          // return unprocessed events
    362          return (events ^ SAMPLEAPP_SEND_TO_COORDINATOR_EVT);
   \   00009D   EE           MOV       A,R6
   \   00009E   6402         XRL       A,#0x2
   \   0000A0   FA           MOV       R2,A
   \   0000A1   EF           MOV       A,R7
   \                     ??SampleApp_ProcessEvent_8:
   \   0000A2   FB           MOV       R3,A
   \   0000A3   8004         SJMP      ??SampleApp_ProcessEvent_10
    363          }
    364          
    365            
    366            // Discard unknown events
    367            return 0;
   \                     ??SampleApp_ProcessEvent_9:
   \   0000A5   7A00         MOV       R2,#0x0
   \   0000A7   7B00         MOV       R3,#0x0
   \                     ??SampleApp_ProcessEvent_10:
   \   0000A9   7F04         MOV       R7,#0x4
   \   0000AB   02....       LJMP      ?BANKED_LEAVE_XDATA
    368          }
    369          
    370          /*********************************************************************
    371           * Event Generation Functions
    372           */
    373          /*********************************************************************
    374           * @fn      SampleApp_HandleKeys
    375           *
    376           * @brief   Handles all key events for this device.
    377           *
    378           * @param   shift - true if in shift/alt.
    379           * @param   keys - bit field for key events. Valid entries:
    380           *                 HAL_KEY_SW_2
    381           *                 HAL_KEY_SW_1
    382           *
    383           * @return  none
    384           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    385          void SampleApp_HandleKeys( uint8 shift, uint8 keys )
   \                     SampleApp_HandleKeys:
    386          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
    387            (void)shift;  // Intentionally unreferenced parameter
    388            
    389            if ( keys & HAL_KEY_SW_1 )
   \   000007   A2E0         MOV       C,0xE0 /* A   */.0
   \   000009   5007         JNC       ??SampleApp_HandleKeys_0
    390            {
    391              /* This key sends the Flash Command is sent to Group 1.
    392               * This device will not receive the Flash Command from this
    393               * device (even if it belongs to group 1).
    394               */
    395              SampleApp_SendFlashMessage( SAMPLEAPP_FLASH_DURATION );
   \   00000B                ; Setup parameters for call to function SampleApp_SendFlashMessage
   \   00000B   7AE8         MOV       R2,#-0x18
   \   00000D   7B03         MOV       R3,#0x3
   \   00000F   12....       LCALL     `??SampleApp_SendFlashMessage::?relay`; Banked call to: SampleApp_SendFlashMessage
    396            }
    397          
    398            if ( keys & HAL_KEY_SW_2 )
   \                     ??SampleApp_HandleKeys_0:
   \   000012   EE           MOV       A,R6
   \   000013   A2E1         MOV       C,0xE0 /* A   */.1
   \   000015   5024         JNC       ??SampleApp_HandleKeys_1
    399            {
    400              /* The Flashr Command is sent to Group 1.
    401               * This key toggles this device in and out of group 1.
    402               * If this device doesn't belong to group 1, this application
    403               * will not receive the Flash command sent to group 1.
    404               */
    405              aps_Group_t *grp;
    406              grp = aps_FindGroup( SAMPLEAPP_ENDPOINT, SAMPLEAPP_FLASH_GROUP );
    407              if ( grp )
   \   000017                ; Setup parameters for call to function aps_FindGroup
   \   000017   7A01         MOV       R2,#0x1
   \   000019   7B00         MOV       R3,#0x0
   \   00001B   7914         MOV       R1,#0x14
   \   00001D   12....       LCALL     `??aps_FindGroup::?relay`; Banked call to: aps_FindGroup
   \   000020   8B..         MOV       ?V1,R3
   \   000022   EA           MOV       A,R2
   \   000023   45..         ORL       A,?V1
   \   000025   600B         JZ        ??SampleApp_HandleKeys_2
    408              {
    409                // Remove from the group
    410                aps_RemoveGroup( SAMPLEAPP_ENDPOINT, SAMPLEAPP_FLASH_GROUP );
   \   000027                ; Setup parameters for call to function aps_RemoveGroup
   \   000027   7A01         MOV       R2,#0x1
   \   000029   7B00         MOV       R3,#0x0
   \   00002B   7914         MOV       R1,#0x14
   \   00002D   12....       LCALL     `??aps_RemoveGroup::?relay`; Banked call to: aps_RemoveGroup
   \   000030   8009         SJMP      ??SampleApp_HandleKeys_1
    411              }
    412              else
    413              {
    414                // Add to the flash group
    415                aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group );
   \                     ??SampleApp_HandleKeys_2:
   \   000032                ; Setup parameters for call to function aps_AddGroup
   \   000032   7A..         MOV       R2,#SampleApp_Group & 0xff
   \   000034   7B..         MOV       R3,#(SampleApp_Group >> 8) & 0xff
   \   000036   7914         MOV       R1,#0x14
   \   000038   12....       LCALL     `??aps_AddGroup::?relay`; Banked call to: aps_AddGroup
    416              }
    417            }
    418          }
   \                     ??SampleApp_HandleKeys_1:
   \   00003B   02....       LJMP      ??Subroutine1_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine1_0:
   \   000000   7F02         MOV       R7,#0x2
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    419          
    420          /*********************************************************************
    421           * LOCAL FUNCTIONS
    422           */
    423          
    424          /*********************************************************************
    425           * @fn      SampleApp_MessageMSGCB
    426           *
    427           * @brief   Data message processor callback.  This function processes
    428           *          any incoming data - probably from other devices.  So, based
    429           *          on cluster ID, perform the intended action.
    430           *
    431           * @param   none
    432           *
    433           * @return  none
    434           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    435          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     SampleApp_MessageMSGCB:
    436          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
    437            /*16进制转ASCII码表*/
    438            //uint8 asc_16[16] = {'0','1','2','3','4','5','6','7','8','9','A','B','C','E','F'};
    439            //uint8 i;
    440            uint16 flashTime;
    441            
    442            switch ( pkt->clusterId )
   \   000009   8E82         MOV       DPL,R6
   \   00000B   8F83         MOV       DPH,R7
   \   00000D   A3           INC       DPTR
   \   00000E   A3           INC       DPTR
   \   00000F   A3           INC       DPTR
   \   000010   A3           INC       DPTR
   \   000011   E0           MOVX      A,@DPTR
   \   000012   F5..         MOV       ?V0,A
   \   000014   A3           INC       DPTR
   \   000015   E0           MOVX      A,@DPTR
   \   000016   F5..         MOV       ?V1,A
   \   000018   78..         MOV       R0,#?V0
   \   00001A   12....       LCALL     ?US_SWITCH_SPARSE
   \                     `?<Jumptable for SampleApp_MessageMSGCB>_0`:
   \   00001D   0000         DW        0
   \   00001F   0300         DW        3
   \   000021   0100         DW        1
   \   000023   ....         DW        ??SampleApp_MessageMSGCB_0
   \   000025   0200         DW        2
   \   000027   ....         DW        ??SampleApp_MessageMSGCB_1
   \   000029   0800         DW        8
   \   00002B   ....         DW        ??SampleApp_MessageMSGCB_2
   \   00002D   ....         DW        ??SampleApp_MessageMSGCB_3
    443            {
    444                
    445              case SAMPLEAPP_DHT11_CLUSTERID://温湿度
    446                Y_LED = LEDOPEN;
   \                     ??SampleApp_MessageMSGCB_2:
   \   00002F   D291         SETB      0x90.1
    447                HalUARTWrite ( 0, pkt->cmd.Data, 2 );
   \   000031   EE           MOV       A,R6
   \   000032   2422         ADD       A,#0x22
   \   000034   FE           MOV       R6,A
   \   000035   5001         JNC       ??SampleApp_MessageMSGCB_4
   \   000037   0F           INC       R7
   \                     ??SampleApp_MessageMSGCB_4:
   \   000038                ; Setup parameters for call to function HalUARTWrite
   \   000038   7C02         MOV       R4,#0x2
   \   00003A   7D00         MOV       R5,#0x0
   \   00003C   8E82         MOV       DPL,R6
   \   00003E   8F83         MOV       DPH,R7
   \   000040   E0           MOVX      A,@DPTR
   \   000041   FA           MOV       R2,A
   \   000042   A3           INC       DPTR
   \   000043   E0           MOVX      A,@DPTR
   \   000044   FB           MOV       R3,A
   \   000045   7900         MOV       R1,#0x0
   \   000047   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    448                printf("%s\n",pkt->cmd.Data);
   \   00004A                ; Setup parameters for call to function printf
   \   00004A   8E82         MOV       DPL,R6
   \   00004C   8F83         MOV       DPH,R7
   \   00004E   12....       LCALL     ?PUSH_XSTACK8_X_TWO
   \   000051   7A..         MOV       R2,#`?<Constant "%s\\n">` & 0xff
   \   000053   7B..         MOV       R3,#(`?<Constant "%s\\n">` >> 8) & 0xff
   \   000055   12....       LCALL     `??printf::?relay`; Banked call to: printf
   \   000058   7402         MOV       A,#0x2
   \   00005A   12....       LCALL     ?DEALLOC_XSTACK8
    449                break;
   \   00005D   8069         SJMP      ??SampleApp_MessageMSGCB_3
    450                
    451              case SAMPLEAPP_PERIODIC_CLUSTERID:
    452                HalUARTWrite(0,"I get data\n",11);
   \                     ??SampleApp_MessageMSGCB_0:
   \   00005F                ; Setup parameters for call to function HalUARTWrite
   \   00005F   7C0B         MOV       R4,#0xb
   \   000061   7D00         MOV       R5,#0x0
   \   000063   7A..         MOV       R2,#`?<Constant "I get data\\n">` & 0xff
   \   000065   7B..         MOV       R3,#(`?<Constant "I get data\\n">` >> 8) & 0xff
   \   000067   7900         MOV       R1,#0x0
   \   000069   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    453                if(*(pkt->cmd.Data) == 1)
   \   00006C   EE           MOV       A,R6
   \   00006D   2422         ADD       A,#0x22
   \   00006F   F582         MOV       DPL,A
   \   000071   E4           CLR       A
   \   000072   3F           ADDC      A,R7
   \   000073   F583         MOV       DPH,A
   \   000075   E0           MOVX      A,@DPTR
   \   000076   F8           MOV       R0,A
   \   000077   A3           INC       DPTR
   \   000078   E0           MOVX      A,@DPTR
   \   000079   F583         MOV       DPH,A
   \   00007B   8882         MOV       DPL,R0
   \   00007D   E0           MOVX      A,@DPTR
   \   00007E   6401         XRL       A,#0x1
   \   000080   7046         JNZ       ??SampleApp_MessageMSGCB_3
    454                  B_LED = LEDOPEN;
   \   000082   D290         SETB      0x90.0
   \   000084   8042         SJMP      ??SampleApp_MessageMSGCB_3
    455                break;
    456          
    457              case SAMPLEAPP_FLASH_CLUSTERID:
    458                flashTime = BUILD_UINT16(pkt->cmd.Data[1], pkt->cmd.Data[2] );
    459                HalLedBlink( HAL_LED_4, 4, 50, (flashTime / 4) );
   \                     ??SampleApp_MessageMSGCB_1:
   \   000086   EE           MOV       A,R6
   \   000087   2422         ADD       A,#0x22
   \   000089   F8           MOV       R0,A
   \   00008A   E4           CLR       A
   \   00008B   3F           ADDC      A,R7
   \   00008C   F9           MOV       R1,A
   \   00008D   E8           MOV       A,R0
   \   00008E   FE           MOV       R6,A
   \   00008F   E9           MOV       A,R1
   \   000090   FF           MOV       R7,A
   \   000091   8E82         MOV       DPL,R6
   \   000093   8F83         MOV       DPH,R7
   \   000095   E0           MOVX      A,@DPTR
   \   000096   F8           MOV       R0,A
   \   000097   A3           INC       DPTR
   \   000098   E0           MOVX      A,@DPTR
   \   000099   F9           MOV       R1,A
   \   00009A                ; Setup parameters for call to function HalLedBlink
   \   00009A   8882         MOV       DPL,R0
   \   00009C   8983         MOV       DPH,R1
   \   00009E   A3           INC       DPTR
   \   00009F   E0           MOVX      A,@DPTR
   \   0000A0   FA           MOV       R2,A
   \   0000A1   8882         MOV       DPL,R0
   \   0000A3   8983         MOV       DPH,R1
   \   0000A5   A3           INC       DPTR
   \   0000A6   A3           INC       DPTR
   \   0000A7   E0           MOVX      A,@DPTR
   \   0000A8   F8           MOV       R0,A
   \   0000A9   E4           CLR       A
   \   0000AA   C8           XCH       A,R0
   \   0000AB   F9           MOV       R1,A
   \   0000AC   EA           MOV       A,R2
   \   0000AD   28           ADD       A,R0
   \   0000AE   F5..         MOV       ?V0,A
   \   0000B0   E4           CLR       A
   \   0000B1   39           ADDC      A,R1
   \   0000B2   F5..         MOV       ?V1,A
   \   0000B4   7402         MOV       A,#0x2
   \   0000B6   78..         MOV       R0,#?V0
   \   0000B8   12....       LCALL     ?US_SHR
   \   0000BB   AC..         MOV       R4,?V0
   \   0000BD   AD..         MOV       R5,?V1
   \   0000BF   7B32         MOV       R3,#0x32
   \   0000C1   7A04         MOV       R2,#0x4
   \   0000C3   7908         MOV       R1,#0x8
   \   0000C5   12....       LCALL     `??HalLedBlink::?relay`; Banked call to: HalLedBlink
    460                break;
    461            }
    462          }
   \                     ??SampleApp_MessageMSGCB_3:
   \   0000C8   02....       LJMP      ??Subroutine1_0 & 0xFFFF
   \   0000CB                REQUIRE _A_P1
    463          
    464          /*********************************************************************
    465           * @fn      SampleApp_SendPeriodicMessage
    466           *
    467           * @brief   Send the periodic message.
    468           *
    469           * @param   none
    470           *
    471           * @return  none
    472           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    473          uint8 zclSampleSw_UartBuf[256];
   \                     zclSampleSw_UartBuf:
   \   000000                DS 256
   \   000100                REQUIRE __INIT_XDATA_Z

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    474          void SampleApp_SendPeriodicMessage( void )
   \                     SampleApp_SendPeriodicMessage:
    475          {  
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    476             
    477            printf("s:%s\n",zclSampleSw_UartBuf);
   \   000005                ; Setup parameters for call to function printf
   \   000005   75....       MOV       ?V0,#zclSampleSw_UartBuf & 0xff
   \   000008   75....       MOV       ?V1,#(zclSampleSw_UartBuf >> 8) & 0xff
   \   00000B   78..         MOV       R0,#?V0
   \   00000D   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000010   7A..         MOV       R2,#`?<Constant "s:%s\\n">` & 0xff
   \   000012   7B..         MOV       R3,#(`?<Constant "s:%s\\n">` >> 8) & 0xff
   \   000014   12....       LCALL     `??printf::?relay`; Banked call to: printf
   \   000017   7402         MOV       A,#0x2
   \   000019   12....       LCALL     ?DEALLOC_XSTACK8
    478            uint8 len = strlen((char *)zclSampleSw_UartBuf);
   \   00001C                ; Setup parameters for call to function strlen
   \   00001C   7A..         MOV       R2,#zclSampleSw_UartBuf & 0xff
   \   00001E   7B..         MOV       R3,#(zclSampleSw_UartBuf >> 8) & 0xff
   \   000020   12....       LCALL     `??strlen::?relay`; Banked call to: strlen
    479            
    480           if ( AF_DataRequest( &SampleApp_Periodic_DstAddr, &SampleApp_epDesc,
    481                                 SAMPLEAPP_DHT11_CLUSTERID,
    482                                 len,
    483                                 zclSampleSw_UartBuf,
    484                                 &SampleApp_TransID,
    485                                 AF_DISCV_ROUTE,
    486                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000023                ; Setup parameters for call to function AF_DataRequest
   \   000023   75..1E       MOV       ?V0,#0x1e
   \   000026   78..         MOV       R0,#?V0
   \   000028   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00002B   75....       MOV       ?V0,#SampleApp_TransID & 0xff
   \   00002E   75....       MOV       ?V1,#(SampleApp_TransID >> 8) & 0xff
   \   000031   78..         MOV       R0,#?V0
   \   000033   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000036   75....       MOV       ?V0,#zclSampleSw_UartBuf & 0xff
   \   000039   75....       MOV       ?V1,#(zclSampleSw_UartBuf >> 8) & 0xff
   \   00003C   78..         MOV       R0,#?V0
   \   00003E   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000041   EA           MOV       A,R2
   \   000042   F5..         MOV       ?V0,A
   \   000044   75..00       MOV       ?V1,#0x0
   \   000047   78..         MOV       R0,#?V0
   \   000049   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00004C   75..08       MOV       ?V0,#0x8
   \   00004F   78..         MOV       R0,#?V0
   \   000051   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000054   7920         MOV       R1,#0x20
   \   000056   7C..         MOV       R4,#SampleApp_epDesc & 0xff
   \   000058   7D..         MOV       R5,#(SampleApp_epDesc >> 8) & 0xff
   \   00005A   7A..         MOV       R2,#SampleApp_Periodic_DstAddr & 0xff
   \   00005C   7B..         MOV       R3,#(SampleApp_Periodic_DstAddr >> 8) & 0xff
   \   00005E   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000061   7409         MOV       A,#0x9
   \   000063   02....       LJMP      ?Subroutine0 & 0xFFFF
    487            {
    488            }
    489          //  
    490          /*  
    491            if ( AF_DataRequest( &SampleApp_Periodic_DstAddr, &SampleApp_epDesc,
    492                                 SAMPLEAPP_PERIODIC_CLUSTERID,
    493                                 1,
    494                                 &flage,
    495                                 &SampleApp_TransID,
    496                                 AF_DISCV_ROUTE,
    497                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    498            {
    499            }*/
    500          //  else
    501          //  {
    502          //    // Error occurred in request to send.
    503          //  }
    504          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL     ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine1_0
   \   000003                ; // Fall through to label ??Subroutine1_0
    505          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    506          void SampleApp_SendToCoordinator( void ){ 
   \                     SampleApp_SendToCoordinator:
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV       A,#-0xc
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    507             
    508             
    509             //printf("s:%s\n",zclSampleSw_UartBuf);
    510             
    511            
    512          // Convert temperature, humidity, and light to string
    513          
    514          uint8 len = strlen((char *)zclSampleSw_UartBuf);
   \   00000A                ; Setup parameters for call to function strlen
   \   00000A   7A..         MOV       R2,#zclSampleSw_UartBuf & 0xff
   \   00000C   7B..         MOV       R3,#(zclSampleSw_UartBuf >> 8) & 0xff
   \   00000E   12....       LCALL     `??strlen::?relay`; Banked call to: strlen
    515          
    516          // Setup the destination address for the coordinator
    517          afAddrType_t coordinatorAddr;
    518          coordinatorAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000011   7408         MOV       A,#0x8
   \   000013   12....       LCALL     ?XSTACK_DISP0_8
   \   000016   7402         MOV       A,#0x2
   \   000018   F0           MOVX      @DPTR,A
    519          coordinatorAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   000019   7409         MOV       A,#0x9
   \   00001B   12....       LCALL     ?XSTACK_DISP0_8
   \   00001E   7414         MOV       A,#0x14
   \   000020   F0           MOVX      @DPTR,A
    520          coordinatorAddr.addr.shortAddr = 0x0000; // Replace with the actual coordinator address
   \   000021   85..82       MOV       DPL,?XSP + 0
   \   000024   85..83       MOV       DPH,?XSP + 1
   \   000027   E4           CLR       A
   \   000028   F0           MOVX      @DPTR,A
   \   000029   A3           INC       DPTR
   \   00002A   F0           MOVX      @DPTR,A
    521          
    522          if (AF_DataRequest(&coordinatorAddr, &SampleApp_epDesc,
    523          SAMPLEAPP_DHT11_CLUSTERID,
    524          len,
    525          zclSampleSw_UartBuf,
    526          &SampleApp_TransID,
    527          AF_DISCV_ROUTE,
    528          AF_DEFAULT_RADIUS) == afStatus_SUCCESS)
   \   00002B                ; Setup parameters for call to function AF_DataRequest
   \   00002B   75..1E       MOV       ?V0,#0x1e
   \   00002E   78..         MOV       R0,#?V0
   \   000030   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000033   75....       MOV       ?V0,#SampleApp_TransID & 0xff
   \   000036   75....       MOV       ?V1,#(SampleApp_TransID >> 8) & 0xff
   \   000039   78..         MOV       R0,#?V0
   \   00003B   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00003E   75....       MOV       ?V0,#zclSampleSw_UartBuf & 0xff
   \   000041   75....       MOV       ?V1,#(zclSampleSw_UartBuf >> 8) & 0xff
   \   000044   78..         MOV       R0,#?V0
   \   000046   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000049   EA           MOV       A,R2
   \   00004A   F5..         MOV       ?V0,A
   \   00004C   75..00       MOV       ?V1,#0x0
   \   00004F   78..         MOV       R0,#?V0
   \   000051   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000054   75..08       MOV       ?V0,#0x8
   \   000057   78..         MOV       R0,#?V0
   \   000059   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00005C   7920         MOV       R1,#0x20
   \   00005E   7C..         MOV       R4,#SampleApp_epDesc & 0xff
   \   000060   7D..         MOV       R5,#(SampleApp_epDesc >> 8) & 0xff
   \   000062   7409         MOV       A,#0x9
   \   000064   12....       LCALL     ?XSTACK_DISP101_8
   \   000067   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   00006A   7409         MOV       A,#0x9
   \   00006C   12....       LCALL     ?DEALLOC_XSTACK8
    529          {
    530          // Message sent successfully
    531          }
    532          else
    533          {
    534          // Error occurred in request to send.
    535          }
    536          }
   \   00006F   740C         MOV       A,#0xc
   \   000071   80..         SJMP      ?Subroutine0
    537          
    538          /*********************************************************************
    539           * @fn      SampleApp_SendFlashMessage
    540           *
    541           * @brief   Send the flash message to group 1.
    542           *
    543           * @param   flashTime - in milliseconds
    544           *
    545           * @return  none
    546           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    547          void SampleApp_SendFlashMessage( uint16 flashTime )
   \                     SampleApp_SendFlashMessage:
    548          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV       A,#-0x3
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    549            uint8 buffer[3];
    550            buffer[0] = (uint8)(SampleAppFlashCounter++);
   \   00000A   90....       MOV       DPTR,#SampleAppFlashCounter
   \   00000D   E0           MOVX      A,@DPTR
   \   00000E   85..82       MOV       DPL,?XSP + 0
   \   000011   85..83       MOV       DPH,?XSP + 1
   \   000014   F0           MOVX      @DPTR,A
   \   000015   90....       MOV       DPTR,#SampleAppFlashCounter
   \   000018   E0           MOVX      A,@DPTR
   \   000019   04           INC       A
   \   00001A   F0           MOVX      @DPTR,A
    551            buffer[1] = LO_UINT16( flashTime );
   \   00001B   7401         MOV       A,#0x1
   \   00001D   12....       LCALL     ?XSTACK_DISP0_8
   \   000020   EA           MOV       A,R2
   \   000021   F0           MOVX      @DPTR,A
    552            buffer[2] = HI_UINT16( flashTime );
   \   000022   7402         MOV       A,#0x2
   \   000024   12....       LCALL     ?XSTACK_DISP0_8
   \   000027   EB           MOV       A,R3
   \   000028   F0           MOVX      @DPTR,A
    553          
    554            if ( AF_DataRequest( &SampleApp_Flash_DstAddr, &SampleApp_epDesc,
    555                                 SAMPLEAPP_FLASH_CLUSTERID,
    556                                 3,
    557                                 buffer,
    558                                 &SampleApp_TransID,
    559                                 AF_DISCV_ROUTE,
    560                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000029                ; Setup parameters for call to function AF_DataRequest
   \   000029   75..1E       MOV       ?V0,#0x1e
   \   00002C   78..         MOV       R0,#?V0
   \   00002E   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000031   75....       MOV       ?V0,#SampleApp_TransID & 0xff
   \   000034   75....       MOV       ?V1,#(SampleApp_TransID >> 8) & 0xff
   \   000037   78..         MOV       R0,#?V0
   \   000039   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00003C   7403         MOV       A,#0x3
   \   00003E   12....       LCALL     ?XSTACK_DISP100_8
   \   000041   88..         MOV       ?V0,R0
   \   000043   89..         MOV       ?V1,R1
   \   000045   78..         MOV       R0,#?V0
   \   000047   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00004A   75..03       MOV       ?V0,#0x3
   \   00004D   75..00       MOV       ?V1,#0x0
   \   000050   78..         MOV       R0,#?V0
   \   000052   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000055   75..02       MOV       ?V0,#0x2
   \   000058   78..         MOV       R0,#?V0
   \   00005A   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00005D   7920         MOV       R1,#0x20
   \   00005F   7C..         MOV       R4,#SampleApp_epDesc & 0xff
   \   000061   7D..         MOV       R5,#(SampleApp_epDesc >> 8) & 0xff
   \   000063   7A..         MOV       R2,#SampleApp_Flash_DstAddr & 0xff
   \   000065   7B..         MOV       R3,#(SampleApp_Flash_DstAddr >> 8) & 0xff
   \   000067   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   00006A   7409         MOV       A,#0x9
   \   00006C   12....       LCALL     ?DEALLOC_XSTACK8
    561            {
    562            }
    563            else
    564            {
    565              // Error occurred in request to send.
    566            }
    567          }
   \   00006F   7403         MOV       A,#0x3
   \   000071                REQUIRE ?Subroutine0
   \   000071                ; // Fall through to label ?Subroutine0
    568          
    569          /*********************************************************************
    570          *********************************************************************/
    571          
    572          //第二步将数据发送到节点
    573          	/***********串口数据发送函数*****/
    574          /*
    575          void Coor_sendtonode( uint8 *buf, uint16 len )
    576          {
    577                                          
    578            if ( AF_DataRequest( &SampleApp_Periodic_DstAddr, &SampleApp_epDesc,
    579                                 SAMPLEAPP_PERIODIC_CLUSTERID,   //发送事件,标号,暗号
    580                                 len,  //发送数据长度
    581                                 buf,  //发送的数据地址
    582                                 &SampleApp_TransID,
    583                                 AF_DISCV_ROUTE,
    584                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    585            {
    586            }
    587            else
    588            {
    589              // Error occurred in request to send.
    590            }
    591          }
    592          
    593          	***********定义串口接收处理函数*****/
    594          /*
    595          void Receive_From_Uart(unsigned char port, unsigned char event)
    596          {
    597            uint8 Rx_Count;
    598            (void)port;
    599            unsigned char From_Uart_Cmd[128];
    600           
    601            if (event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT))
    602            {		
    603              //判断是否是串口发生接收数据的事件
    604              Rx_Count = Hal_UART_RxBufLen ( 0 );   //求出串口数据的长度
    605              HalUARTRead(0,From_Uart_Cmd,Rx_Count); 
    606              //串口0   存放数据的buf  接收数据的长度
    607              HalUARTWrite(0,From_Uart_Cmd,Rx_Count);  //回写测试
    608          
    609          	********第四步 ***实现控制数据转发处理**end***
    610          	//发送由网关接收到的数据到具体节点
    611              Coor_sendtonode(From_Uart_Cmd,Rx_Count);
    612            }
    613          }*/
    614          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    615          static void zclSampleSw_UartCB(uint8 port, uint8 event)    
   \                     zclSampleSw_UartCB:
    616          {    
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    617              //获取当前串口接收缓冲区有多少字节的数据    
    618              uint8 rxLen = Hal_UART_RxBufLen(HAL_UART_PORT_0);   
   \   000004                ; Setup parameters for call to function Hal_UART_RxBufLen
   \   000004   7900         MOV       R1,#0x0
   \   000006   12....       LCALL     `??Hal_UART_RxBufLen::?relay`; Banked call to: Hal_UART_RxBufLen
   \   000009   EA           MOV       A,R2
    619              
    620              if(rxLen != 0)//如果字节数数量不等于0   
   \   00000A   600C         JZ        ??zclSampleSw_UartCB_0
    621              {
    622                  //从串口缓冲区中读取数据
    623                  HalUARTRead(HAL_UART_PORT_0, zclSampleSw_UartBuf, rxLen); 
   \   00000C                ; Setup parameters for call to function HalUARTRead
   \   00000C   FC           MOV       R4,A
   \   00000D   7D00         MOV       R5,#0x0
   \   00000F   7A..         MOV       R2,#zclSampleSw_UartBuf & 0xff
   \   000011   7B..         MOV       R3,#(zclSampleSw_UartBuf >> 8) & 0xff
   \   000013   7900         MOV       R1,#0x0
   \   000015   12....       LCALL     `??HalUARTRead::?relay`; Banked call to: HalUARTRead
    624                   
    625              }    
    626          }
   \                     ??zclSampleSw_UartCB_0:
   \   000018   D083         POP       DPH
   \   00001A   D082         POP       DPL
   \   00001C   02....       LJMP      ?BRET

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SampleApp_Init::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SampleApp_ProcessEvent::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SampleApp_HandleKeys::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SampleApp_MessageMSGCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SampleApp_SendPeriodicMessage::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SendPeriodicMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SampleApp_SendToCoordinator::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SendToCoordinator

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SampleApp_SendFlashMessage::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SendFlashMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??zclSampleSw_UartCB::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_UartCB

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Group 1">`:
   \   000000   47726F75     DB "Group 1"
   \            70203100

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SampleApp">`:
   \   000000   53616D70     DB "SampleApp"
   \            6C654170
   \            7000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "%s\\n">`:
   \   000000   25730A00     DB "%s\012"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "I get data\\n">`:
   \   000000   49206765     DB "I get data\012"
   \            74206461
   \            74610A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "s:%s\\n">`:
   \   000000   733A2573     DB "s:%s\012"
   \            0A00    
    627          static void zclSampleSw_InitUart(void)    
    628          {    
    629            halUARTCfg_t uartConfig;    
    630            uartConfig.baudRate            = HAL_UART_BR_115200;//波特率  
    631           uartConfig.flowControl         = FALSE;//关闭硬件流控  
    632            uartConfig.flowControlThreshold= 0;//和流控相关  
    633           uartConfig.rx.maxBufSize       = 128;//接收缓冲区大小
    634            uartConfig.tx.maxBufSize      = 128;//发送缓冲区大小
    635            uartConfig.idleTimeout        = 6;//默认超时时间  
    636           uartConfig.intEnable          = TRUE;// 使能中断  
    637            uartConfig.callBackFunc       = zclSampleSw_UartCB;//设置回调函数
    638            /* Start UART */    
    639            HalUARTOpen(HAL_UART_PORT_0, &uartConfig);// 根据配置打开串口0  
    640          }
    641          

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0     22   SampleApp_HandleKeys
        0     10   -> SampleApp_SendFlashMessage
        0     10   -> aps_AddGroup
        0     10   -> aps_FindGroup
        0     10   -> aps_RemoveGroup
      0     43   SampleApp_Init
        0     40   -> HalLcdWriteString
        0     40   -> HalUARTOpen
        0     40   -> RegisterForKeys
        0     40   -> afRegister
        0     40   -> aps_AddGroup
        0     43   -> osal_memcpy
        0     40   -> osal_start_timerEx
      0     24   SampleApp_MessageMSGCB
        0     10   -> HalLedBlink
        0     10   -> HalUARTWrite
        0     12   -> printf
      0     12   SampleApp_ProcessEvent
        0     12   -> SampleApp_HandleKeys
        0     12   -> SampleApp_MessageMSGCB
        0     12   -> SampleApp_SendToCoordinator
        0     12   -> osal_msg_deallocate
        0     12   -> osal_msg_receive
        0     12   -> osal_start_timerEx
      1     32   SampleApp_SendFlashMessage
        0     22   -> AF_DataRequest
      0     19   SampleApp_SendPeriodicMessage
        0     19   -> AF_DataRequest
        0     12   -> printf
        0     10   -> strlen
      0     43   SampleApp_SendToCoordinator
        0     31   -> AF_DataRequest
        0     22   -> strlen
      2      0   zclSampleSw_UartCB
        2      0   -> HalUARTRead
        2      0   -> Hal_UART_RxBufLen


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       4  ?<Constant "%s\n">
       8  ?<Constant "Group 1">
      12  ?<Constant "I get data\n">
      10  ?<Constant "SampleApp">
       6  ?<Constant "s:%s\n">
       5  ??Subroutine1_0
       3  ?Subroutine0
       1  P1DIR
       1  P1SEL
       1  SampleAppFlashCounter
       1  SampleAppPeriodicCounter
       4  SampleApp_ClusterList
      12  SampleApp_Flash_DstAddr
      18  SampleApp_Group
      62  SampleApp_HandleKeys
       6  SampleApp_HandleKeys::?relay
     280  SampleApp_Init
       6  SampleApp_Init::?relay
     203  SampleApp_MessageMSGCB
       6  SampleApp_MessageMSGCB::?relay
       1  SampleApp_NwkState
      12  SampleApp_Periodic_DstAddr
     174  SampleApp_ProcessEvent
       6  SampleApp_ProcessEvent::?relay
     113  SampleApp_SendFlashMessage
       6  SampleApp_SendFlashMessage::?relay
     102  SampleApp_SendPeriodicMessage
       6  SampleApp_SendPeriodicMessage::?relay
     115  SampleApp_SendToCoordinator
       6  SampleApp_SendToCoordinator::?relay
      12  SampleApp_SimpleDesc
       1  SampleApp_TaskID
       1  SampleApp_TransID
       6  SampleApp_epDesc
       1  _A_P1
     256  zclSampleSw_UartBuf
      31  zclSampleSw_UartCB
       6  zclSampleSw_UartCB::?relay

 
 1 088 bytes in segment BANKED_CODE
    48 bytes in segment BANK_RELAYS
     3 bytes in segment SFR_AN
    56 bytes in segment XDATA_ROM_C
   309 bytes in segment XDATA_Z
 
    48 bytes of CODE     memory
    56 bytes of CONST    memory
     0 bytes of DATA     memory (+ 3 bytes shared)
 1 088 bytes of HUGECODE memory
   309 bytes of XDATA    memory

Errors: none
Warnings: none
